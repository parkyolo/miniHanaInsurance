<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/public/sample/sample.css">


    <style>
        /* 세로형 메뉴 스타일 */
        #sample_header .nav_menu {
            display: none;
        }

        #sample_header.show_menu .nav_menu {
            display: block;
        }


header{
            display: block;
        }
.map_wrap {
    position: relative;
    width: 100%;
    height: 350px;
}

.title {
    font-weight: bold;
    display: block;
}

.hAddr {
    position: absolute;
    left: 10px;
    top: 10px;
    border-radius: 2px;
    background: #fff;
    background: rgba(255, 255, 255, 0.8);
    z-index: 1;
    padding: 5px;
}

#centerAddr {
    display: block;
    margin-top: 2px;
    font-weight: normal;
}

.bAddr {
    padding: 5px;
    text-overflow: ellipsis;
    overflow: hidden;
    white-space: nowrap;
}

      
   </style>
</head>

<body onload="step2load()">
    <div id="wrap">
        <header data-include-path="/public/sample/sampleheader.html"></header>
        <div id="container">
            <div id="contents">
                <div class="contents-title">
                    <h3>사고접수</h3>
                    <p> <!-- class="wPc100 f16 tac mt30"-->
                        하나손해보험은 회원의 개인정보를 신중히 취급합니다.<br>
                        가입하신 정보는 회원님의 동의 없이 공개되지 않으며, 개인정보 보호정책에 의해 보호를 받습니다.<br>
                        편리한 서비스와 보다 유용한 정보제공을 위해 고객님의 정확한 정보를 입력하여 주시기 바랍니다.
                    </p>
                </div>

                <div class="step" id="step1">
                    <div class="step-title" id="step1-title">
                        <span class="step1-name">STEP1</span>
                        <div class="step1-contents">
                            접수자 정보 확인
                        </div>
                    </div>

                    <div class="step-contents" id="step1-contents">
                        <div class="contents-input">
                            <div class="input" id="name-input">
                                <div class="title" id="name-input-title">
                                    <h3>접수자명</h3>
                                </div>
                                <div class="contents" id="name-input-contents">
                                    <input placeholder="이름을 입력" type="text" class="name" id="name">
                                </div>

                            </div>

                            <div class="input" id="phone-input">
                                <div class="title" id="phone-input-title">
                                    <h3>연락처</h3>
                                </div>
                                <div class="contents" id="phonenum-input-contents">
                                    <select name="contact-type" id="contact-type">
                                        <option value="default" selected>휴대전화</option>
                                        <option value="company">회사전화</option>
                                        <option value="home">자택전화</option>
                                    </select>
                                    <select name="contact-front" id="contact-front">
                                        <option value="default" selected>010</option>
                                        <option value="011">011</option>
                                        <option value="017">017</option>
                                        <option value="018">018</option>
                                        <option value="019">019</option>
                                    </select>
                                    <input type="text" class="phonenum" maxlength="4" id="pnoMiddle"
                                        onkeyup="moveCursor(this)">
                                    -
                                    <input type="text" class="phonenum" maxlength="4" id="pnoBack">
                                </div>
                            </div>
                            <div class="input" id="date-input">
                                <div class="title" id="date-input-title">
                                    <h3>사고일시</h3>
                                </div>
                                <div class="contents" id="date-input-contents">
                                    <input class="date-input-text" type="date" id="date">
                                </div>
                            </div>

                            <div class="input" id="carnum-input">
                                <div class="title" id="carnum-input-title">
                                    <h3>차량번호</h3>
                                </div>
                                <div class="contents" id="carnum-input-contents">
                                    <input placeholder="예)12가 3456" type="text" id="carnum">
                                </div>
                            </div>
                        </div>

                    </div>

                </div>


                <div class="step" id="step2">
                    <div class="step-title" id="step2-title">
                        <span class="step1-name">STEP2</span>
                        <div class="step1-contents">
                            사고 현황 확인
                        </div>
                    </div>

                    <div class="step-contents" id="step2-contents">
                        <div class="contents-input">
                            <div class="input" id="accidenttype-input">
                                <div class="title" id="accidenttype-input-title">
                                    <h3>사고유형</h3>
                                </div>
                                <div class="contents" id="accidenttype-input-contents">
                                    <div class="type-of-accident" id="type-of-accident">
                                        <input type="radio" name="accident-type">차대차
                                        <input type="radio" name="accident-type">차량단독
                                        <input type="radio" name="accident-type">차대인
                                        <input type="radio" name="accident-type">기타
                                        <!--안보였다가 기타 선택하면 나타나도록-->
                                        <input type="text" name="accident-type" placeholder="사고유형을 입력해주세요"
                                            style="display:none;">
                                    </div>
                                </div>
                            </div>

                            <div class="input" id="accidentcontent-input">
                                <div class="title" id="accidentcontent-input-title">
                                    <h3>사고 경위</h3>
                                </div>
                                <div class="contents" id="accidentcontent-input-contents">
                                    <input placeholder="자세한 사고 경위를 작성해주세요" type="text" class="accidentcontent"
                                        name="accidentcontent">
                                </div>
                            </div>
                            <div class="input" id="accidentcontent-input">
                                <div class="title" id="accidentcontent-input-title">
                                    <h3>사고 사진</h3>
                                </div>
                                <div class="contents" id="accidentcontent-input-img">
                                    <input type="file" id="upload" accept="image/**" multiple id="chooseimg">
                                    <div id="thumbnails"></div>

                                </div>
                            </div>
                            <div class="input" id="accidentplace-input">
                                <div class="title" id="accidentplace-input-title">
                                    <h3>사고 발생 위치</h3>
                                </div>
                                <div class="contents" id="accidentplace-input-contents">
                                    <input type="button" value="지도에서 찾기" onclick="showmap()" style="width:500px;">
                                    <input type="text" id="mapAddr"></input>


                                    <!--지도 영역-->
                                    <div class="map-area" style="display: none;" id="map-area">
                                        <div class="map_wrap">
                                            <div id="map"
                                                style="width:100%;height:100%;position:relative;overflow:hidden;"></div>
                                            <div class="hAddr">
                                                <span class="title">지도중심기준 행정동 주소정보</span>
                                                <span id="centerAddr"></span>
                                            </div>
                                        </div>
                                        <div class="address-from-map">
                                            주소 : <span id="mapaddress"></span>
                                        </div>
                                        <div>

                                            <input type="button" id="address" value="주소 저장하기" onclick="saveAddress()">
                                        </div>
                                    </div>


                                </div>
                            </div>

                        </div>


                    </div>

                </div>


                <div class="step" id="step3">
                    <div class="step-title" id="step3-title">
                        <span class="step1-name">STEP3</span>
                        <div class="step1-contents">
                            피해사항 확인
                        </div>
                    </div>

                    <div class="step-contents" id="step2-contents">
                        <div class="contents-input">
                            <div class="input" id="accidenttype-input">
                                <div class="title" id="accidenttype-input-title">
                                    <h3>파손 물품</h3>
                                </div>
                                <div class="contents" id="accidenttype-input-contents">
                                    <div class="type-of-accident" id="type-of-accident">
                                        <input type="radio" name="fragile-type" default>자기차량
                                        <input type="radio" name="fragile-type">상대차량
                                        <input type="radio" name="fragile-type">기타피해물
                                        <!--안보였다가 기타 선택하면 나타나도록-->
                                        <input type="text" name="accident-type" placeholder="사고유형을 입력해주세요"
                                            style="display:none;">
                                    </div>
                                </div>
                            </div>

                            <div class="input" id="accidenttype-input">
                                <div class="title" id="accidenttype-input-title">
                                    <h3>다친 사람</h3>
                                </div>
                                <div class="contents" id="accidenttype-input-contents">
                                    <div class="type-of-accident" id="type-of-accident">
                                        <input type="radio" name="fragile-type" default>자기차량
                                        <input type="radio" name="fragile-type">상대차량
                                        <input type="radio" name="fragile-type">기타피해물
                                        <!--안보였다가 기타 선택하면 나타나도록-->
                                        <input type="text" name="accident-type" placeholder="사고유형을 입력해주세요"
                                            style="display:none;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="submit" id="submit">
                    <input type="button" value="사고접수하기" id="submitbtn" onclick="submitAll()">
                </div>



            </div>





        </div>

    </div>



    </div>
    <script>
        // "step-title" 클래스를 가진 모든 요소를 가져옵니다.
        var stepTitles = document.getElementsByClassName("step-title");

        // 각 step title에 클릭 이벤트 리스너를 추가합니다.
        for (var i = 0; i < stepTitles.length; i++) {
            stepTitles[i].addEventListener("click", toggleStepContents);
        }

        // 스텝 콘텐츠를 토글하는 함수입니다.
        function toggleStepContents() {
            // 관련된 스텝 콘텐츠 요소를 찾습니다.
            var stepContents = this.nextElementSibling;

            // "open" 클래스와 "close" 클래스를 토글합니다.
            if (stepContents.classList.contains("open")) {
                stepContents.classList.remove("open");
                stepContents.classList.add("close");
                map.relayout(); 

            } else {
                stepContents.classList.remove("close");
                stepContents.classList.add("open");
            }
        }



    </script>
    <script>
        document.getElementById('upload').addEventListener('change', function (event) {
            var file = event.target.files[0];
            var reader = new FileReader();

            reader.onload = function (e) {
                var image = new Image();
                image.src = e.target.result;
                image.onload = function () {
                    var canvas = document.createElement('canvas');
                    var ctx = canvas.getContext('2d');

                    var thumbnailWidth = 150;
                    var thumbnailHeight = 150;

                    if (image.width > image.height) {
                        thumbnailHeight = Math.floor(image.height / image.width * thumbnailWidth);
                    } else {
                        thumbnailWidth = Math.floor(image.width / image.height * thumbnailHeight);
                    }

                    canvas.width = thumbnailWidth;
                    canvas.height = thumbnailHeight;

                    ctx.drawImage(image, 0, 0, thumbnailWidth, thumbnailHeight);

                    var thumbnailElement = document.createElement('div');
                    thumbnailElement.classList.add('thumbnail');
                    thumbnailElement.style.backgroundImage = 'url(' + canvas.toDataURL() + ')';

                    var thumbnailsContainer = document.getElementById('thumbnails');
                    thumbnailsContainer.appendChild(thumbnailElement);
                };
            };

            reader.readAsDataURL(file);
        });
    </script>
    <!--지도 스크립트-->
    <script type="text/javascript"
        src="//dapi.kakao.com/v2/maps/sdk.js?appkey=d39547eaa3031f363ef9ac7d93cbca8e&libraries=services"></script>
    <script>
        var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
            mapOption = {
                center: new kakao.maps.LatLng(37.566826, 126.9786567), // 지도의 중심좌표 -> 현재 내 위치로 가져오기
                level: 1 // 지도의 확대 레벨
            };

        // 지도를 생성합니다    
        var map = new kakao.maps.Map(mapContainer, mapOption);

        // 주소-좌표 변환 객체를 생성합니다
        var geocoder = new kakao.maps.services.Geocoder();

        var marker = new kakao.maps.Marker(), // 클릭한 위치를 표시할 마커입니다
            infowindow = new kakao.maps.InfoWindow({ zindex: 1 }); // 클릭한 위치에 대한 주소를 표시할 인포윈도우입니다

        // 현재 지도 중심좌표로 주소를 검색해서 지도 좌측 상단에 표시합니다
        searchAddrFromCoords(map.getCenter(), displayCenterInfo);

        // 지도를 클릭했을 때 클릭 위치 좌표에 대한 주소정보를 표시하도록 이벤트를 등록합니다
        kakao.maps.event.addListener(map, 'click', function (mouseEvent) {
            searchDetailAddrFromCoords(mouseEvent.latLng, function (result, status) {
                if (status === kakao.maps.services.Status.OK) {

                    var detailAddr = !!result[0].road_address ? '<div>도로명주소 : ' + result[0].road_address.address_name + '</div>' : '';


                    detailAddr += '<div>지번 주소 : ' + result[0].address.address_name + '</div>';

                    var content = '<div class="bAddr">' +
                        '<span class="title" id="realaddress">법정동 주소정보</span>' +
                        detailAddr +
                        '</div>';

                    // 마커를 클릭한 위치에 표시합니다 
                    marker.setPosition(mouseEvent.latLng);
                    marker.setMap(map);

                    // 인포윈도우에 클릭한 위치에 대한 법정동 상세 주소정보를 표시합니다
                    infowindow.setContent(content);
                    infowindow.open(map, marker);

                    var infoDiv = document.getElementById('mapaddress');
                    infoDiv.innerHTML = result[0].address.address_name;


                }
            });
        });

        // 중심 좌표나 확대 수준이 변경됐을 때 지도 중심 좌표에 대한 주소 정보를 표시하도록 이벤트를 등록합니다
        kakao.maps.event.addListener(map, 'idle', function () {
            searchAddrFromCoords(map.getCenter(), displayCenterInfo);
        });

        function saveAddress() {

            localStorage.setItem('address', document.getElementById('mapaddress').innerHTML);
            const address = window.localStorage.getItem('address');
            const realaddress = document.getElementById('mapAddr');
            realaddress.value = address;
            console.log(address);
            document.getElementById('map-area').style.display = "none";

        }

        function searchAddrFromCoords(coords, callback) {
            // 좌표로 행정동 주소 정보를 요청합니다
            geocoder.coord2RegionCode(coords.getLng(), coords.getLat(), callback);
        }

        function searchDetailAddrFromCoords(coords, callback) {
            // 좌표로 법정동 상세 주소 정보를 요청합니다
            geocoder.coord2Address(coords.getLng(), coords.getLat(), callback);
        }

        // 지도 좌측상단에 지도 중심좌표에 대한 주소정보를 표출하는 함수입니다
        function displayCenterInfo(result, status) {
            if (status === kakao.maps.services.Status.OK) {
                var infoDiv = document.getElementById('centerAddr');

                for (var i = 0; i < script result.length; i++) {
                    // 행정동의 region_type 값은 'H' 이므로
                    if (result[i].region_type === 'H') {
                        infoDiv.innerHTML = result[i].address_name;
                        break;
                    }
                }
            }
        }
    </script>

    <script>
        window.addEventListener('DOMContentLoaded', function () {
            var step1 = document.getElementById('step1');
            var step2 = document.getElementById('step2');
            var step3 = document.getElementById('step3');

            var step1Title = document.getElementById('step1-title');
            var step2Title = document.getElementById('step2-title');
            var step3Title = document.getElementById('step3-title');

            step1Title.addEventListener('click', function () {
                toggleStep(step1);
            });

            step2Title.addEventListener('click', function () {
                toggleStep(step2);
                map.relayout(); 

            });
            step3Title.addEventListener('click', function () {
                toggleStep(step3);
            });

            function toggleStep(step) {
                if (step.classList.contains('active')) {
                    step.classList.remove('active');
                } else {
                    step.classList.add('active');
                }
            }
        });
    </script>
    </div>
    <footer data-include-path="/public/html/layout/footer.html" style="white-space: nowrap;"></footer>
    </div>
    <script>
        window.addEventListener('load', function () {
            var allElements = document.getElementsByTagName('*');
            Array.prototype.forEach.call(allElements, function (el) {
                var includePath = el.dataset.includePath;
                if (includePath) {
                    var xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function () {
                        if (this.readyState == 4 && this.status == 200) {
                            el.outerHTML = this.responseText;
                        }
                    };
                    xhttp.open('GET', includePath, true);
                    xhttp.send();
                }
            });
        });
    </script>
    <script src="/src/script/signupPage/accidentReport.js"></script>

</body>

</html>